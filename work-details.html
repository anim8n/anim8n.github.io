<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- 添加YouTube要求的referrer策略 -->
    <meta name="referrer" content="strict-origin-when-cross-origin">
    <!-- 防止页面缓存 -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>MOON</title>
    <style>
        body {
            font-family: "Source Han Sans SC", "思源黑体", "黑体", "SimHei", Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #000;
            color: #fff;
            overflow-x: hidden;
        }
        .container {
            max-width: 100%;
            margin: 0 auto;
            padding: 0;
        }
        h1 {
            text-align: center;
            color: #fff;
            font-size: 24px;
            font-weight: 400;
            letter-spacing: 2px;
            margin: 0;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #fff;
        }
        input {
            width: 100%;
            padding: 12px 16px;
            border: none;
            border-bottom: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 0;
            background-color: transparent;
            color: #fff;
            font-size: 16px;
            box-sizing: border-box;
            transition: border-color 0.3s ease;
        }
        input:focus {
            outline: none;
            border-color: #fff;
        }
        button {
            background-color: transparent;
            color: #fff;
            border: none;
            padding: 12px 20px;
            border-radius: 0;
            cursor: pointer;
            font-size: 16px;
            font-weight: 400;
            letter-spacing: 1px;
            transition: opacity 0.3s ease;
            font-family: inherit; /* 继承父元素的字体 */
        }
        button:hover {
            opacity: 0.7;
        }
        .header {
            display: flex;
            align-items: center;
            margin: 10px 60px 10px;
            padding: 0;
            border-bottom: none;
            height: 60px; /* 高度增加20px */
            font-family: "Source Han Sans SC", "思源黑体", "黑体", "SimHei", Arial, sans-serif;
        }
        
        .header * {
            font-family: inherit;
        }
        
        .nav-container {
            display: flex;
            gap: 30px;
            align-items: center;
            margin-left: auto;
            margin-right: 20px;
        }
        
        .nav-item {
            color: #fff;
            text-decoration: none;
            cursor: pointer;
            padding: 8px 16px;
            border-radius: 4px;
            transition: color 0.3s ease, background-color 0.3s ease;
        }
        
        .nav-item:hover {
            background-color: rgba(255, 255, 255, 0.1);
            color: #a6a4ff;
        }
        
        .project-item, .joinus-item {
            position: relative;
            cursor: pointer;
            padding: 8px 16px;
            border-radius: 4px;
            transition: color 0.3s ease, background-color 0.3s ease;
            color: #fff;
        }
        
        .project-item:hover, .joinus-item:hover {
            background-color: rgba(255, 255, 255, 0.1);
            color: #a6a4ff;
        }
        
        .project-dropdown, .joinus-dropdown {
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(0, 0, 0, 0.5);
            border: none;
            border-radius: 0;
            padding: 8px 0;
            min-width: 180px;
            display: none;
            box-shadow: none;
            z-index: 1000;
        }
        
        .project-item:hover .project-dropdown, .joinus-item:hover .joinus-dropdown {
            display: block;
        }
        
        .dropdown-item {
            padding: 8px 16px;
            color: #fff;
            cursor: pointer;
            transition: color 0.3s ease, background-color 0.3s ease;
            text-decoration: none;
            display: block;
            text-align: center;
        }
        
        .dropdown-item:hover {
            background-color: rgba(255, 255, 255, 0.2);
            color: #a6a4ff;
        }
        
        .search-container {
            display: flex;
            gap: 0;
        }
        
        #searchInput {
            padding: 6px 10px;
            border: none;
            border-bottom: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 0;
            font-size: 14px;
            width: 220px;
            background-color: transparent;
            color: #fff;
            transition: border-color 0.3s ease;
        }
        
        #searchInput:focus {
            outline: none;
            border-color: #fff;
        }
        
        #searchBtn {
            padding: 6px 14px;
            background-color: transparent;
            color: #fff;
            border: none;
            border-radius: 0;
            font-size: 14px;
            cursor: pointer;
            transition: opacity 0.3s ease;
        }
        
        #searchBtn:hover {
            opacity: 0.7;
        }
        

        .error {
            color: rgba(255, 255, 255, 0.7);
            margin: 40px 60px;
            text-align: center;
            font-size: 16px;
            letter-spacing: 1px;
        }

        /* 首图样式 */
        #main-image-container {
            width: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
            background-color: #222222;
            position: relative;
        }

        #main-image {
            width: 100%;
            height: auto;
            object-fit: contain;
            display: block;
            transition: opacity 0.3s ease;
        }
        
        /* YouTube视频容器样式 */
        #youtube-video-container {
            position: relative;
            width: 80%;
            margin: 20px auto;
            max-height: 600px;
            height: auto;
            overflow: hidden;
        }
        
        /* 保持16:9宽高比 */
        #youtube-video-container::before {
            content: "";
            display: block;
            padding-bottom: 56.25%; /* 16:9 宽高比 */
        }
        
        /* YouTube视频iframe样式 */
        #youtube-video-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: none;
        }
        
        /* 播放按钮样式 */
        #play-button {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: transparent;
            color: white;
            border: none;
            border-radius: 0;
            width: auto;
            height: auto;
            font-size: 50px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s ease;
            padding: 0;
            pointer-events: none;
        }
        
        /* 鼠标悬浮效果 */
        #main-image-container:hover #main-image {
            opacity: 0.7;
        }
        
        #main-image-container:hover #play-button {
            opacity: 1;
        }

        /* 作品信息样式 */
        #work-info {
            padding: 40px 60px;
        }

        #work-title {
            font-size: 32px;
            font-weight: 400;
            margin-bottom: 20px;
            letter-spacing: 2px;
            color: #a6a4ff;
        }

        #work-description {
            font-size: 16px;
            line-height: 1.6;
            color: #818181;
            margin: 0;
            text-align: justify;
            text-align-last: left;
        }

        /* Character Design、Layout、Colorkey、Art Still、Prop Design展示区域样式 */
        #characters-section,
        #layout-section,
        #colorkey-section,
        #art-still-section,
        #prop-design-section {
            padding: 40px 0;
        }

        #characters-title,
        #layout-title,
        #colorkey-title,
        #art-still-title,
        #prop-design-title {
            font-size: 24px;
            font-weight: 400;
            margin-bottom: 20px;
            letter-spacing: 2px;
            padding: 0 60px;
            color: #a6a4ff;
        }

        #characters-container,
        #layout-container,
        #colorkey-container,
        #art-still-container,
        #prop-design-container {
            position: relative;
            overflow: hidden;
            width: 100%;
            background-color: #222222;
            padding: 20px 0;
        }

        #characters-scroll,
        #layout-scroll,
        #colorkey-scroll,
        #art-still-scroll,
        #prop-design-scroll {
            display: flex;
            gap: 20px;
            overflow-x: auto;
            padding: 10px 0;
            scroll-behavior: smooth;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none; /* Firefox */
        }

        #characters-scroll::-webkit-scrollbar,
        #layout-scroll::-webkit-scrollbar,
        #colorkey-scroll::-webkit-scrollbar,
        #art-still-scroll::-webkit-scrollbar,
        #prop-design-scroll::-webkit-scrollbar {
            display: none; /* Chrome, Safari, Opera */
        }

        .animatic-image {
            flex: 0 0 auto;
            width: 300px;
            min-width: 300px;
            max-width: 300px;
            height: auto;
            object-fit: cover;
            border-radius: 4px;
            transition: transform 0.3s ease;
        }

        .animatic-image:hover {
            transform: scale(1.05);
        }

        .scroll-arrow {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            width: 50px;
            height: 50px;
            background-color: transparent;
            color: white;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            font-size: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
            transition: background-color 0.3s ease;
        }

        .scroll-arrow:hover {
            background-color: rgba(0, 0, 0, 0.3);
        }

        #prev-arrow,
        #animatic-prev-arrow,
        #characters-prev-arrow,
        #layout-prev-arrow,
        #colorkey-prev-arrow,
        #art-still-prev-arrow,
        #prop-design-prev-arrow {
            left: 0;
        }

        #next-arrow,
        #animatic-next-arrow,
        #characters-next-arrow,
        #layout-next-arrow,
        #colorkey-next-arrow,
        #art-still-next-arrow,
        #prop-design-next-arrow {
            right: 0;
        }

        /* 确保Layout区域的图片大小与Animatic区域一致 */
        #layout-scroll img {
            width: 300px;
            min-width: 300px;
            max-width: 300px;
            height: auto;
            object-fit: cover;
        }

        /* Color Script展示区域样式 */
        #color-script-section {
            padding: 40px 0;
            background-color: #222222;
        }

        #color-script-title {
            font-size: 24px;
            font-weight: 400;
            margin-bottom: 20px;
            letter-spacing: 2px;
            padding: 0 60px;
            color: #a6a4ff;
        }

        #color-script-container {
            width: 100%;
            padding: 0 60px;
            box-sizing: border-box;
        }

        #color-script-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }

        .color-script-image {
            width: 100%;
            height: auto;
            object-fit: cover;
            border-radius: 4px;
            transition: transform 0.3s ease;
            cursor: pointer;
        }

        .color-script-image:hover {
            transform: scale(1.02);
        }

        /* 悬浮大图样式 */
        #image-modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.9);
        }

        .modal-content {
            position: relative;
            margin: 5% auto;
            max-width: 90%;
            max-height: 90%;
        }

        .modal-image {
            display: block;
            width: 100%;
            height: auto;
            max-height: 80vh;
            object-fit: contain;
        }

        .close {
            position: absolute;
            top: -40px;
            right: 0;
            color: #f1f1f1;
            font-size: 40px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover {
            color: #bbb;
            text-decoration: none;
            cursor: pointer;
        }

        /* 底部信息区域样式 */
        .footer {
            background-color: #4d4d4d;
            color: #fff;
            padding: 40px 60px;
            margin-top: 60px;
            font-family: "Source Han Sans SC", "思源黑体", "黑体", "SimHei", Arial, sans-serif;
        }
        .footer-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
        }
        .footer-left {
            text-align: left;
            font-size: 14px;
            color: #adadad;
        }
        .footer-right {
            display: flex;
            gap: 15px;
        }
        .footer-right a {
            display: inline-block;
            margin-left: 10px;
            transition: opacity 0.3s ease;
        }
        .footer-right a:hover {
            opacity: 0.7;
        }
        .footer-right img {
            width: 20px;
            height: 20px;
        }
    </style>
    <!-- 引入Token Manager -->
    <script src="token-manager.js"></script>
</head>
<body>
    <div class="container">
        <div class="header">
            <img src="logo.png" alt="Logo" style="height: 200px; width: auto; margin-left: -60px;">
            <div class="nav-container">
                <a href="index.html" class="nav-item">HOME</a>
                <div class="project-item">
                    <span>Projects</span>
                    <div class="project-dropdown">
                        <a href="feature_film.html" class="dropdown-item">Feature Film</a>
                        <a href="AD.html" class="dropdown-item">AD</a>
                    </div>
                </div>
                <a href="about.html" class="nav-item">About</a>
                <div class="joinus-item">
                    <span>Join us</span>
                    <div class="joinus-dropdown">
                        <a href="http://www.baidu.com" class="dropdown-item" target="_blank">Send Resume</a>
                        <a href="http://www.baidu.com" class="dropdown-item" target="_blank">Collaborate</a>
                    </div>
                </div>
            </div>
            <!-- <div class="search-container">
                <input type="text" id="searchInput" placeholder="Projects Title...">
                <button id="searchBtn">Search</button>
            </div> -->
        </div>

        <!-- 首图/视频显示区域 -->
        <div id="main-image-container">
            <img id="main-image">
            <div id="youtube-video-container" style="display: none;"></div>
            <button id="play-button">▶</button>
        </div>

        <!-- 作品信息显示区域 -->
        <div id="work-info">
            <h2 id="work-title"></h2>
            <p id="work-description"></p>
        </div>

        <!-- Art Still展示区域 -->
        <div id="art-still-section" style="display: none;">
            <h3 id="art-still-title">Art Still</h3>
            <div id="art-still-container">
                <button id="art-still-prev-arrow" class="scroll-arrow">&lt;</button>
                <div id="art-still-scroll"></div>
                <button id="art-still-next-arrow" class="scroll-arrow">&gt;</button>
            </div>
        </div>

        <!-- Character Design展示区域 -->
        <div id="characters-section" style="display: none;">
            <h3 id="characters-title">Character Design</h3>
            <div id="characters-container">
                <button id="characters-prev-arrow" class="scroll-arrow">&lt;</button>
                <div id="characters-scroll"></div>
                <button id="characters-next-arrow" class="scroll-arrow">&gt;</button>
            </div>
        </div>

        <!-- Prop Design展示区域 -->
        <div id="prop-design-section" style="display: none;">
            <h3 id="prop-design-title">Prop Design</h3>
            <div id="prop-design-container">
                <button id="prop-design-prev-arrow" class="scroll-arrow">&lt;</button>
                <div id="prop-design-scroll"></div>
                <button id="prop-design-next-arrow" class="scroll-arrow">&gt;</button>
            </div>
        </div>

        <!-- Layout展示区域 -->
        <div id="layout-section" style="display: none;">
            <h3 id="layout-title">Layout</h3>
            <div id="layout-container">
                <button id="layout-prev-arrow" class="scroll-arrow">&lt;</button>
                <div id="layout-scroll"></div>
                <button id="layout-next-arrow" class="scroll-arrow">&gt;</button>
            </div>
        </div>

        <!-- Color Script展示区域 -->
        <div id="color-script-section" style="display: none;">
            <h3 id="color-script-title">Colorkey</h3>
            <div id="color-script-container">
                <div id="color-script-grid"></div>
            </div>
        </div>

        <!-- Colorkey展示区域 -->
        <div id="colorkey-section" style="display: none;">
            <h3 id="colorkey-title">Color Script</h3>
            <div id="colorkey-container">
                <button id="colorkey-prev-arrow" class="scroll-arrow">&lt;</button>
                <div id="colorkey-scroll"></div>
                <button id="colorkey-next-arrow" class="scroll-arrow">&gt;</button>
            </div>
        </div>
    </div>

    <!-- 底部信息区域 -->
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-left">
                Join us&emsp;hello@animoon.studio
            </div>
            <div class="footer-right">
                <a href="https://www.linkedin.com/company/animoon" target="_blank" title="LinkedIn">
                    <img src="跳转图标/linkin.png" alt="LinkedIn">
                </a>
                <a href="https://www.xiaohongshu.com/user/profile/65f04c29000000000b032c4f?xsec_token=YBO9eicZW3j8axk0PtThG-eLzpA2nJZesUk_ysgyPGljs=&xsec_source=app_share&xhsshare=CopyLink&shareRedId=ODtIMDdINkI2NzUyOTgwNjZFOTo2SDpP&apptime=1768987162&share_id=788a15547d1847ab933d7159de83d91b" target="_blank" title="小红书">
                    <img src="跳转图标/red note.png" alt="小红书">
                </a>
                <a href="https://vimeo.com/animoon" target="_blank" title="Vimeo">
                    <img src="跳转图标/v.png" alt="Vimeo">
                </a>
                <a href="https://www.instagram.com/studioanim8n?igsh=MTdvcDB1cmNnNW5mMg==" target="_blank" title="Instagram">
                    <img src="跳转图标/ins.png" alt="Instagram">
                </a>
            </div>
        </div>
    </footer>

    <!-- 悬浮大图容器 -->
    <div id="image-modal" style="display: none;">
        <div class="modal-content">
            <span class="close">&times;</span>
            <img class="modal-image" src="">
        </div>
    </div>

    <script>
        // GitHub API配置
        const owner = 'anim8n';
        const repo = 'portfolio';
        const token = getGitHubToken();

        // 获取仓库结构
        async function fetchRepoStructure(owner, repo, token) {
            try {
                // 直接使用默认分支"main"
                const defaultBranch = 'main';

                // 使用Git Trees API获取完整仓库结构
                const treeUrl = `https://api.github.com/repos/${owner}/${repo}/git/trees/${defaultBranch}?recursive=1`;
                const treeResponse = await fetch(treeUrl, {
                    headers: {
                        'Authorization': `token ${token}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });

                if (!treeResponse.ok) {
                    const errorText = await treeResponse.text();
                    throw new Error(`获取仓库结构失败: ${treeResponse.status} ${treeResponse.statusText} - ${errorText}`);
                }

                const treeData = await treeResponse.json();
                return treeData;
            } catch (error) {
                console.error('获取仓库结构时出错:', error);
                throw error;
            }
        }

        // 获取文本文件内容
        async function fetchTextFile(url) {
            try {
                const response = await fetch(url);
                if (!response.ok) {
                    throw new Error(`获取文件失败: ${response.status} ${response.statusText}`);
                }
                return await response.text();
            } catch (error) {
                console.error('获取文本文件时出错:', error);
                return '';
            }
        }

        // 获取URL参数
        function getUrlParams() {
            const params = {};
            const queryString = window.location.search;
            const urlParams = new URLSearchParams(queryString);
            
            for (const [key, value] of urlParams.entries()) {
                params[key] = decodeURIComponent(value);
            }
            
            return params;
        }

        // 加载作品详情
        async function loadWorkDetails() {
            const params = getUrlParams();
            const folder = params.folder || 'feature film/ONE WORLD'; // 默认值
            
            try {
                // 获取仓库结构
                const treeData = await fetchRepoStructure(owner, repo, token);
                const entries = treeData.tree;
                
                // 过滤出当前作品文件夹下的所有文件
                const workFiles = entries.filter(entry => 
                    entry.path.startsWith(folder + '/') && entry.type === 'blob'
                );
                
                // 获取标题文件
                const titleFile = workFiles.find(file => file.path === folder + '/title.txt');
                let title = folder.split('/').pop(); // 默认使用文件夹名作为标题
                if (titleFile) {
                    const titleUrl = `https://raw.githubusercontent.com/${owner}/${repo}/main/${titleFile.path}`;
                    title = await fetchTextFile(titleUrl);
                    title = title.trim();
                }
                
                // 获取描述文件
                const descFile = workFiles.find(file => file.path === folder + '/description.txt');
                let description = '暂无描述';
                if (descFile) {
                    const descUrl = `https://raw.githubusercontent.com/${owner}/${repo}/main/${descFile.path}`;
                    description = await fetchTextFile(descUrl);
                    description = description.trim();
                }
                
                // 获取首图文件 - 仅查找根目录下的图片
                const rootImageFiles = workFiles.filter(file => 
                    (file.path.endsWith('.jpg') || file.path.endsWith('.jpeg') || file.path.endsWith('.png')) &&
                    !file.path.includes('/imgs/') // 排除imgs子文件夹
                );
                
                // 获取视频链接文件
                const videoFile = workFiles.find(file => file.path === folder + '/video.txt');
                let videoUrl = null;
                if (videoFile) {
                    const videoUrlRaw = `https://raw.githubusercontent.com/${owner}/${repo}/main/${videoFile.path}`;
                    videoUrl = await fetchTextFile(videoUrlRaw);
                    videoUrl = videoUrl.trim();
                }
                
                let imageUrl = 'img_not_found.png'; // 默认图片
                if (rootImageFiles.length > 0) {
                    imageUrl = `https://raw.githubusercontent.com/${owner}/${repo}/main/${rootImageFiles[0].path}`;
                }
                
                // 显示作品信息
                document.getElementById('work-title').textContent = title;
                document.getElementById('work-description').textContent = description;
                
                // 提取YouTube视频ID的函数
                function extractYouTubeVideoId(url) {
                    // 移除可能的空白字符
                    url = url.trim();
                    let videoId = '';
                    
                    // 尝试多种方法提取视频ID
                    try {
                        // 方法1：处理标准YouTube URL格式
                        if (url.includes('youtube.com/watch?v=')) {
                            const params = new URL(url).searchParams;
                            videoId = params.get('v');
                        }
                        // 方法2：处理缩短URL
                        else if (url.includes('youtu.be/')) {
                            videoId = url.split('youtu.be/')[1].split('?')[0];
                        }
                        // 方法3：处理嵌入URL
                        else if (url.includes('youtube.com/embed/')) {
                            videoId = url.split('youtube.com/embed/')[1].split('?')[0];
                        }
                        // 方法4：处理Shorts URL
                        else if (url.includes('youtube.com/shorts/')) {
                            videoId = url.split('youtube.com/shorts/')[1].split('?')[0];
                        }
                        // 方法5：回退到正则表达式
                        else {
                            const youtubeRegex = /(?:youtu\.be\/|youtube\.com\/(?:watch\?v=|embed\/|v\/|.*?[\?&]v=|.*?[\?&]vi=|shorts\/))([^&"'>?\s]+)/i;
                            const match = url.match(youtubeRegex);
                            if (match && match[1]) {
                                videoId = match[1];
                            }
                        }
                        
                        // 确保视频ID是11个字符（标准YouTube视频ID长度）
                        if (videoId && videoId.length === 11) {
                            return videoId;
                        }
                    } catch (e) {
                        console.error('视频ID提取出错:', e);
                    }
                    
                    return null;
                }
                
                // 设置首图或内嵌视频
                const mainImage = document.getElementById('main-image');
                const youtubeContainer = document.getElementById('youtube-video-container');
                const playButton = document.getElementById('play-button');
                
                // 检查是否有视频URL
                if (videoUrl) {
                    const videoId = extractYouTubeVideoId(videoUrl);
                    
                    if (videoId) {
                        // 有YouTube视频，显示内嵌视频
                        youtubeContainer.style.display = 'block';
                        mainImage.style.display = 'none';
                        playButton.style.display = 'none';
                        
                        // 创建YouTube iframe
                        const iframe = document.createElement('iframe');
                        iframe.src = `https://www.youtube.com/embed/${videoId}`;
                        iframe.allow = 'accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; fullscreen';
                        iframe.allowFullscreen = true;
                        
                        // 添加YouTube要求的referrer策略
                        iframe.setAttribute('referrerpolicy', 'strict-origin-when-cross-origin');
                        iframe.referrerPolicy = 'strict-origin-when-cross-origin';
                        
                        // 添加错误处理
                        iframe.onerror = function() {
                            console.error('YouTube视频加载失败，回退到图片模式');
                            // 加载失败时回退到图片显示
                            youtubeContainer.style.display = 'none';
                            mainImage.style.display = 'block';
                            playButton.style.display = 'block';
                            
                            // 恢复图片显示
                            mainImage.setAttribute('data-src', imageUrl);
                        };
                        
                        youtubeContainer.innerHTML = '';
                        youtubeContainer.appendChild(iframe);
                    } else {
                        // 不是YouTube视频，只显示图片
                        mainImage.setAttribute('data-src', imageUrl);
                    }
                } else {
                    // 没有视频，只显示图片
                    mainImage.setAttribute('data-src', imageUrl);
                }
                
                // 添加加载完成和错误处理
                mainImage.onload = function() {
                    this.style.opacity = '1';
                };
                mainImage.onerror = function() {
                    this.src = 'img_not_found.png';
                    this.style.opacity = '1';
                };
                
                // 初始化Intersection Observer用于懒加载和区域并行加载
                const observer = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            const element = entry.target;
                            
                            // 如果是图片元素，直接加载
                            if (element.tagName === 'IMG') {
                                const img = element;
                                const src = img.getAttribute('data-src');
                                if (src) {
                                    img.src = src;
                                    img.style.opacity = '0';
                                    img.style.transition = 'opacity 0.3s ease-in-out';
                                    observer.unobserve(img);
                                }
                            } 
                            // 如果是图片容器或区域，并行加载该区域内的所有图片
                            else {
                                const images = element.querySelectorAll('img[data-src]');
                                images.forEach(img => {
                                    const src = img.getAttribute('data-src');
                                    if (src) {
                                        img.src = src;
                                        img.style.opacity = '0';
                                        img.style.transition = 'opacity 0.3s ease-in-out';
                                        observer.unobserve(img);
                                    }
                                });
                                observer.unobserve(element);
                            }
                        }
                    });
                }, {
                    rootMargin: '100px 0px', // 提前100px开始加载
                    threshold: 0.1
                });
                
                // 观察首图
                observer.observe(mainImage);
                
                // 获取并显示Character Design图片
                // 识别含有"character design"的路径，以及原有的"/imgs/characters/"路径
                const charactersFiles = workFiles.filter(file => 
                    ((file.path.toLowerCase().includes('/imgs/') &&
                      file.path.toLowerCase().split('/imgs/')[1].split('/')[0].includes('character') &&
                      file.path.toLowerCase().split('/imgs/')[1].split('/')[0].includes('design')) ||
                     file.path.includes('/imgs/characters/')) && 
                    (file.path.endsWith('.jpg') || file.path.endsWith('.jpeg') || file.path.endsWith('.png'))
                );

                const charactersScroll = document.getElementById('characters-scroll');
                charactersScroll.innerHTML = ''; // 清空现有内容

                if (charactersFiles.length > 0) {
                    // 显示Character Design区域
                    document.getElementById('characters-section').style.display = 'block';
                    
                    charactersFiles.forEach(file => {
                        const img = document.createElement('img');
                        img.className = 'animatic-image';
                        // 使用data-src实现懒加载
                        img.setAttribute('data-src', `https://raw.githubusercontent.com/${owner}/${repo}/main/${file.path}`);
                        img.alt = `Character Design image`;
                        img.style.opacity = '0';
                        img.style.transition = 'opacity 0.3s ease-in-out';
                        
                        // 添加点击事件，显示悬浮大图
                        img.addEventListener('click', () => {
                            const modal = document.getElementById('image-modal');
                            const modalImg = document.querySelector('.modal-image');
                            modal.style.display = 'block';
                            modalImg.src = img.getAttribute('data-src');
                        });
                        
                        // 添加加载完成和错误处理
                        img.onload = function() {
                            this.style.opacity = '1';
                        };
                        img.onerror = function() {
                            this.src = 'img_not_found.png';
                            this.style.opacity = '1';
                        };
                        
                        charactersScroll.appendChild(img);
                    });

                    // 实现箭头滚动功能
                    const charactersPrevArrow = document.getElementById('characters-prev-arrow');
                    const charactersNextArrow = document.getElementById('characters-next-arrow');
                    const scrollAmount = 320; // 滚动距离（图片宽度+间距）

                    charactersPrevArrow.addEventListener('click', () => {
                        charactersScroll.scrollBy({ left: -scrollAmount, behavior: 'smooth' });
                    });

                    charactersNextArrow.addEventListener('click', () => {
                        charactersScroll.scrollBy({ left: scrollAmount, behavior: 'smooth' });
                    });

                    // 观察Characters区域，实现区域内图片并行加载
                    const charactersSection = document.getElementById('characters-section');
                    observer.observe(charactersSection);
                } else {
                    // 如果没有Characters图片，隐藏整个Characters区域
                    document.getElementById('characters-section').style.display = 'none';
                }

                // 获取并显示Color Script图片
                const colorScriptFiles = workFiles.filter(file => 
                    file.path.includes('/imgs/colorkey/') && 
                    (file.path.endsWith('.jpg') || file.path.endsWith('.jpeg') || file.path.endsWith('.png'))
                );

                const colorScriptGrid = document.getElementById('color-script-grid');
                colorScriptGrid.innerHTML = ''; // 清空现有内容

                if (colorScriptFiles.length > 0) {
                    // 显示Color Script区域
                    document.getElementById('color-script-section').style.display = 'block';
                    
                    colorScriptFiles.forEach(file => {
                        const img = document.createElement('img');
                        img.className = 'color-script-image';
                        // 使用data-src实现懒加载
                        img.setAttribute('data-src', `https://raw.githubusercontent.com/${owner}/${repo}/main/${file.path}`);
                        img.alt = `Color Script image`;
                        img.style.opacity = '0';
                        img.style.transition = 'opacity 0.3s ease-in-out';
                        
                        // 添加点击事件，显示悬浮大图
                        img.addEventListener('click', () => {
                            const modal = document.getElementById('image-modal');
                            const modalImg = document.querySelector('.modal-image');
                            modal.style.display = 'block';
                            modalImg.src = img.getAttribute('data-src');
                        });
                        
                        // 添加加载完成和错误处理
                        img.onload = function() {
                            this.style.opacity = '1';
                        };
                        img.onerror = function() {
                            this.src = 'img_not_found.png';
                            this.style.opacity = '1';
                        };
                        
                        colorScriptGrid.appendChild(img);
                    });

                    // 观察Color Script区域，实现区域内图片并行加载
                    const colorScriptSection = document.getElementById('color-script-section');
                    observer.observe(colorScriptSection);
                } else {
                    // 如果没有Color Script图片，隐藏整个Color Script区域
                    document.getElementById('color-script-section').style.display = 'none';
                }

                // 获取并显示Layout图片
                const layoutFiles = workFiles.filter(file => 
                    file.path.includes('/imgs/layout/') && 
                    (file.path.endsWith('.jpg') || file.path.endsWith('.jpeg') || file.path.endsWith('.png'))
                );

                const layoutScroll = document.getElementById('layout-scroll');
                layoutScroll.innerHTML = ''; // 清空现有内容

                if (layoutFiles.length > 0) {
                    // 显示Layout区域
                    document.getElementById('layout-section').style.display = 'block';
                    
                    layoutFiles.forEach(file => {
                        const img = document.createElement('img');
                        img.className = 'animatic-image';
                        // 使用data-src实现懒加载
                        img.setAttribute('data-src', `https://raw.githubusercontent.com/${owner}/${repo}/main/${file.path}`);
                        img.alt = `Layout image`;
                        img.style.opacity = '0';
                        img.style.transition = 'opacity 0.3s ease-in-out';
                        
                        // 添加点击事件，显示悬浮大图
                        img.addEventListener('click', () => {
                            const modal = document.getElementById('image-modal');
                            const modalImg = document.querySelector('.modal-image');
                            modal.style.display = 'block';
                            modalImg.src = img.getAttribute('data-src');
                        });
                        
                        // 添加加载完成和错误处理
                        img.onload = function() {
                            this.style.opacity = '1';
                        };
                        img.onerror = function() {
                            this.src = 'img_not_found.png';
                            this.style.opacity = '1';
                        };
                        
                        layoutScroll.appendChild(img);
                    });

                    // 实现箭头滚动功能
                    const layoutPrevArrow = document.getElementById('layout-prev-arrow');
                    const layoutNextArrow = document.getElementById('layout-next-arrow');
                    const scrollAmount = 320; // 滚动距离（图片宽度+间距）

                    layoutPrevArrow.addEventListener('click', () => {
                        layoutScroll.scrollBy({ left: -scrollAmount, behavior: 'smooth' });
                    });

                    layoutNextArrow.addEventListener('click', () => {
                        layoutScroll.scrollBy({ left: scrollAmount, behavior: 'smooth' });
                    });

                    // 观察Layout区域，实现区域内图片并行加载
                    const layoutSection = document.getElementById('layout-section');
                    observer.observe(layoutSection);
                } else {
                    // 如果没有Layout图片，隐藏整个Layout区域
                    document.getElementById('layout-section').style.display = 'none';
                }

                // 获取并显示Colorkey图片
                const colorkeyFiles = workFiles.filter(file => 
                    file.path.includes('/imgs/color script/') && 
                    (file.path.endsWith('.jpg') || file.path.endsWith('.jpeg') || file.path.endsWith('.png'))
                );

                const colorkeyScroll = document.getElementById('colorkey-scroll');
                colorkeyScroll.innerHTML = ''; // 清空现有内容

                if (colorkeyFiles.length > 0) {
                    // 显示Colorkey区域
                    document.getElementById('colorkey-section').style.display = 'block';
                    
                    colorkeyFiles.forEach(file => {
                        const img = document.createElement('img');
                        img.className = 'animatic-image';
                        // 使用data-src实现懒加载
                        img.setAttribute('data-src', `https://raw.githubusercontent.com/${owner}/${repo}/main/${file.path}`);
                        img.alt = `Colorkey image`;
                        img.style.opacity = '0';
                        img.style.transition = 'opacity 0.3s ease-in-out';
                        
                        // 添加点击事件，显示悬浮大图
                        img.addEventListener('click', () => {
                            const modal = document.getElementById('image-modal');
                            const modalImg = document.querySelector('.modal-image');
                            modal.style.display = 'block';
                            modalImg.src = img.getAttribute('data-src');
                        });
                        
                        // 添加加载完成和错误处理
                        img.onload = function() {
                            this.style.opacity = '1';
                        };
                        img.onerror = function() {
                            this.src = 'img_not_found.png';
                            this.style.opacity = '1';
                        };
                        
                        colorkeyScroll.appendChild(img);
                    });

                    // 实现箭头滚动功能
                    const colorkeyPrevArrow = document.getElementById('colorkey-prev-arrow');
                    const colorkeyNextArrow = document.getElementById('colorkey-next-arrow');
                    const scrollAmount = 320; // 滚动距离（图片宽度+间距）

                    colorkeyPrevArrow.addEventListener('click', () => {
                        colorkeyScroll.scrollBy({ left: -scrollAmount, behavior: 'smooth' });
                    });

                    colorkeyNextArrow.addEventListener('click', () => {
                        colorkeyScroll.scrollBy({ left: scrollAmount, behavior: 'smooth' });
                    });

                    // 观察Colorkey区域，实现区域内图片并行加载
                    const colorkeySection = document.getElementById('colorkey-section');
                    observer.observe(colorkeySection);
                } else {
                    // 如果没有Colorkey图片，隐藏整个Colorkey区域
                    document.getElementById('colorkey-section').style.display = 'none';
                }

                // 获取并显示Art Still图片
                // 只匹配imgs/文件夹中特定的art still文件夹
                const artStillFiles = workFiles.filter(file => 
                    (file.path.endsWith('.jpg') || file.path.endsWith('.jpeg') || file.path.endsWith('.png')) &&
                    // 必须在imgs/文件夹下
                    file.path.toLowerCase().includes('/imgs/') &&
                    // 只匹配明确的art still或类似名称的文件夹
                    (file.path.toLowerCase().split('/imgs/')[1].split('/')[0] === 'art still' || 
                     file.path.toLowerCase().split('/imgs/')[1].split('/')[0] === 'art' ||
                     file.path.toLowerCase().split('/imgs/')[1].split('/')[0] === 'still' ||
                     file.path.toLowerCase().split('/imgs/')[1].split('/')[0] === '艺术' ||
                     file.path.toLowerCase().split('/imgs/')[1].split('/')[0] === '作品' ||
                     file.path.toLowerCase().split('/imgs/')[1].split('/')[0] === 'artwork')
                );

                const artStillScroll = document.getElementById('art-still-scroll');
                artStillScroll.innerHTML = ''; // 清空现有内容

                if (artStillFiles.length > 0) {
                    // 显示Art Still区域
                    document.getElementById('art-still-section').style.display = 'block';
                    
                    artStillFiles.forEach(file => {
                        const img = document.createElement('img');
                        img.className = 'animatic-image';
                        // 使用data-src实现懒加载
                        img.setAttribute('data-src', `https://raw.githubusercontent.com/${owner}/${repo}/main/${file.path}`);
                        img.alt = `Art Still image`;
                        img.style.opacity = '0';
                        img.style.transition = 'opacity 0.3s ease-in-out';
                        
                        // 添加点击事件，显示悬浮大图
                        img.addEventListener('click', () => {
                            const modal = document.getElementById('image-modal');
                            const modalImg = document.querySelector('.modal-image');
                            modal.style.display = 'block';
                            modalImg.src = img.getAttribute('data-src');
                        });
                        
                        // 添加加载完成和错误处理
                        img.onload = function() {
                            this.style.opacity = '1';
                        };
                        img.onerror = function() {
                            this.src = 'img_not_found.png';
                            this.style.opacity = '1';
                        };
                        
                        artStillScroll.appendChild(img);
                    });

                    // 实现箭头滚动功能
                    const artStillPrevArrow = document.getElementById('art-still-prev-arrow');
                    const artStillNextArrow = document.getElementById('art-still-next-arrow');
                    const scrollAmount = 320; // 滚动距离（图片宽度+间距）

                    artStillPrevArrow.addEventListener('click', () => {
                        artStillScroll.scrollBy({ left: -scrollAmount, behavior: 'smooth' });
                    });

                    artStillNextArrow.addEventListener('click', () => {
                        artStillScroll.scrollBy({ left: scrollAmount, behavior: 'smooth' });
                    });

                    // 观察Art Still区域，实现区域内图片并行加载
                    const artStillSection = document.getElementById('art-still-section');
                    observer.observe(artStillSection);
                } else {
                    // 如果没有Art Still图片，隐藏整个Art Still区域
                    document.getElementById('art-still-section').style.display = 'none';
                }

                // 获取并显示Prop Design图片
                // 只匹配imgs/文件夹中特定的prop design文件夹
                const propDesignFiles = workFiles.filter(file => 
                    (file.path.endsWith('.jpg') || file.path.endsWith('.jpeg') || file.path.endsWith('.png')) &&
                    // 必须在imgs/文件夹下
                    file.path.toLowerCase().includes('/imgs/') &&
                    // 只匹配明确的prop design或类似名称的文件夹
                    (file.path.toLowerCase().split('/imgs/')[1].split('/')[0] === 'prop design' || 
                     file.path.toLowerCase().split('/imgs/')[1].split('/')[0] === 'prop' ||
                     file.path.toLowerCase().split('/imgs/')[1].split('/')[0] === 'props' ||
                     file.path.toLowerCase().split('/imgs/')[1].split('/')[0] === '道具' ||
                     file.path.toLowerCase().split('/imgs/')[1].split('/')[0] === '道具设计')
                );

                const propDesignScroll = document.getElementById('prop-design-scroll');
                propDesignScroll.innerHTML = ''; // 清空现有内容

                if (propDesignFiles.length > 0) {
                    // 显示Prop Design区域
                    document.getElementById('prop-design-section').style.display = 'block';
                    
                    propDesignFiles.forEach(file => {
                        const img = document.createElement('img');
                        img.className = 'animatic-image';
                        // 使用data-src实现懒加载
                        img.setAttribute('data-src', `https://raw.githubusercontent.com/${owner}/${repo}/main/${file.path}`);
                        img.alt = `Prop Design image`;
                        img.style.opacity = '0';
                        img.style.transition = 'opacity 0.3s ease-in-out';
                        
                        // 添加点击事件，显示悬浮大图
                        img.addEventListener('click', () => {
                            const modal = document.getElementById('image-modal');
                            const modalImg = document.querySelector('.modal-image');
                            modal.style.display = 'block';
                            modalImg.src = img.getAttribute('data-src');
                        });
                        
                        // 添加加载完成和错误处理
                        img.onload = function() {
                            this.style.opacity = '1';
                        };
                        img.onerror = function() {
                            this.src = 'img_not_found.png';
                            this.style.opacity = '1';
                        };
                        
                        propDesignScroll.appendChild(img);
                    });

                    // 实现箭头滚动功能
                    const propDesignPrevArrow = document.getElementById('prop-design-prev-arrow');
                    const propDesignNextArrow = document.getElementById('prop-design-next-arrow');
                    const scrollAmount = 320; // 滚动距离（图片宽度+间距）

                    propDesignPrevArrow.addEventListener('click', () => {
                        propDesignScroll.scrollBy({ left: -scrollAmount, behavior: 'smooth' });
                    });

                    propDesignNextArrow.addEventListener('click', () => {
                        propDesignScroll.scrollBy({ left: scrollAmount, behavior: 'smooth' });
                    });

                    // 观察Prop Design区域，实现区域内图片并行加载
                    const propDesignSection = document.getElementById('prop-design-section');
                    observer.observe(propDesignSection);
                } else {
                    // 如果没有Prop Design图片，隐藏整个Prop Design区域
                    document.getElementById('prop-design-section').style.display = 'none';
                }
            } catch (error) {
                console.error('加载作品详情失败:', error);
            }
        }

        // 点击关闭按钮或模态框外部关闭悬浮大图
        const modal = document.getElementById('image-modal');
        const closeBtn = document.querySelector('.close');
        
        closeBtn.addEventListener('click', () => {
            modal.style.display = 'none';
        });
        
        modal.addEventListener('click', (e) => {
            if (e.target === modal) {
                modal.style.display = 'none';
            }
        });

        // 页面加载完成后执行
        window.addEventListener('load', loadWorkDetails);
    </script>
</body>
</html>